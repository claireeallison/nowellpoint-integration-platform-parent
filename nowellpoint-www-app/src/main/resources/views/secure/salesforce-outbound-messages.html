<#import "template.html" as t>

    <@t.page>

        <#include "navbar.html" />

        <div class="container-fluid">
            <br>
            <div class="row">
                <div id="status-message"></div>
                <div class="col-sm-2">
                    <#include "salesforce-service-nav.html" />
                </div>
                <div class="col-lg-10 col-md-10 col-sm-10">
                    <div class="col-lg-10 col-md-10 col-sm-10">
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-2">
                                <div class="panel panel-primary">
                                    <div class="statcard p-a-md m-b">
                                        <h3 class="statcard-number">${serviceInstance.activeEnvironments} ${labels["of"]} ${serviceInstance.environments?size}</h3>
                                        <span class="statcard-desc">${labels["active.environments"]}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="hr-divider">
                            <h3 class="hr-divider-content hr-divider-heading"></h3>
                        </div>

                        <br>

                        <div class="row">

                            <dl class="dl-horizontal">
                                <dt>${labels["connector"]}</dt>
                                <dd><a href="${labels['base.path']}/${(salesforceConnector.id)!}">${(salesforceConnector.id)!}</a></dd>
                                <dt>${labels["id"]}</dt>
                                <dd>${(salesforceConnector.identity.id)!}</dd>
                                <dt>${labels["name"]}</dt>
                                <dd>${(salesforceConnector.organization.name)!}</dd>
                                <dt>${labels["organization.type"]}</dt>
                                <dd>${(salesforceConnector.organization.organizationType)!}</dd>
                                <dt>${labels["instance.name"]}</dt>
                                <dd>${(salesforceConnector.organization.instanceName)!}</dd>
                            </dl>

                            <div class="hr-divider">
                                <h3 class="hr-divider-content hr-divider-heading"></h3>
                            </div>

                            <br>

                            <form id="form" name="form" class="form-horizontal" role="form">

                                <div class="form-group">
                                    <label class="control-label col-sm-2 col-md-2 col-lg-2" for="name">${labels["name"]}</label>
                                    <div class="col-sm-3 col-md-3 col-lg-3">
                                        <input type="text" class="form-control" name="name" id="name" value="${(serviceInstance.name)!}" required="" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-sm-2 col-md-2 col-lg-2" for="defaultEnvironment">${labels["default.environment"]}</label>
                                    <div class="col-sm-3 col-md-3 col-lg-3">
                                        <select id="defaultEnvironment" name="defaultEnvironment" class="form-control" value="${(serviceInstance.defaultEnvironment)!}" required="">
                                            <option value="">--- ${labels["select.environment"]} ---</option>
                                            <#list serviceInstance.environments as environment>
                                                <#if environment.active>
                                                    <#if environment.name==( serviceInstance.defaultEnvironment)! "">
                                                        <option value="${environment.name}" selected>${environment.label}</option>
                                                    </#if>
                                                    <#if environment.name !=( serviceInstance.defaultEnvironment)! "">
                                                        <option value="${environment.name}">${environment.label}</option>
                                                    </#if>
                                                </#if>
                                            </#list>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-md-offset-2 col-lg-offset-2 col-sm-5 col-md-5 col-lg-5">
                                        <button type="submit" name="submit" id="submit" class="btn btn-primary">${labels["save"]}</button>
                                    </div>
                                </div>
                            </form>

                            <div class="hr-divider">
                                <h3 class="hr-divider-content hr-divider-heading"></h3>
                            </div>

                            <#list serviceInstance.environments?sort_by( "index") as environment>
                                <#if environment.active>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="panel">
                                        <div class="panel-heading">
                                            <h3 class="panel-title">${(environment.name)!}</h3>
                                        </div>

                                        <div class="panel-body">
                                            <div class="pull-left">
                                                <b>${labels["label"]}:</b> ${(environment.label)!}
                                            </div>
                                        <br>
                                            <a href="#" class="btn btn-sm btn-primary" role="button" name="start" id="start">${labels["start"]}</a>
                                             <a href="${labels['base.path']}/${(salesforceConnector.id)!}/service/${(serviceInstance.key)!}/test-connection/${(environment.name)!}" name="testConnection" id="testConnection">${labels["test.connection"]}</a>
                                        </div> 

                                    </div>
                                </div>
                                    </#if>    
                            </#list>

                            <div class="col-lg-10 col-md-10 col-sm-10">

                                <br>

                                <p class="text-danger">
                                    ${labels["delete.warning"]}
                                </p>

                                <a href="" class="btn btn-lg btn-danger-outline confirm-delete" title="${labels['delete.service']}" data-toggle="modal" aria-hidden="true" role="button" data-id="${serviceInstance.key!}" data-message="${serviceInstance.serviceName!}" data-title="${deleteMessage}">${labels["delete.service"]}</a>

                            </div>
                        </div>







                        <!--
                    <div class="col-sm-12">

                        <div class="hr-divider">
                            <h3 class="hr-divider-content hr-divider-heading">${labels["sobjects"]}</h3>
                        </div>

                        <br>

                        <div id="auto_load_div">
                            <#include "salesforce-outbound-message-part.html" />
                        </div>

                    </div>
-->
                    </div>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2">
                </div>
            </div>

            <#include "confirm-dialog.html"/>
            <#include "spinner.html" />

            <script>
                $('#confirm').click(function(e) {
                    $('#confirmDialog').modal('hide');
                    $.ajax({
                        url: "${labels['base.path']}/${(salesforceConnector.id)!}/service/${(serviceInstance.key)!}",
                        type: "DELETE",
                        complete: function(data) {
                            window.location.replace("${labels['base.path']}/${(salesforceConnector.id)!}");
                        }
                    });
                });

                $('#form').submit(function(e) {
                    var params = $("#form").serialize();
                    $.ajax({
                        dataType: "html",
                        type: "POST",
                        url: "${labels['base.path']}/${(salesforceConnector.id)!}/service/${(serviceInstance.key)!}",
                        data: params,
                        complete: function(data) {
                            $("#status-message").html(data.responseText);
                        }
                    });

                    e.preventDefault();

                });


                $('#loginForm').submit(function(e) {
                    var params = $("#loginForm").serialize();
                    $.ajax({
                        dataType: "html",
                        type: "POST",
                        url: "${labels['base.path']}/${(salesforceConnector.id)!}/service/${(serviceInstance.key)!}/sobjects",
                        data: params,
                        complete: function(data) {
                            $("#auto_load_div").html(data.responseText);
                        }
                    });

                    e.preventDefault();

                });

                $("#environment").change(function() {
                    alert("Handler for .change() called.");
                });
            </script>

    </@t.page>